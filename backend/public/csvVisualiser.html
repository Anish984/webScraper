<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client-side CSV Viewer with Links</title>
    <style>
        /* Basic Styling for the App Layout */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .app {
            width: 100%;
            max-width: 1000px;
        }

        .card {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .subtitle {
            color: #666;
            line-height: 1.6;
        }

        /* Controls and Buttons */
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .file-label {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .file-label:hover {
            background-color: #0056b3;
        }

        .file-label .icon {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .file-input {
            display: none; /* Hide the default file input */
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            transition: background-color 0.3s;
        }

        .btn:hover:not(:disabled) {
            background-color: #1e7e34;
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .file-name {
            font-style: italic;
            color: #555;
            flex-grow: 1;
        }

        .tag {
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #495057;
        }

        /* Status Messages */
        .status {
            padding: 10px 0;
            font-weight: bold;
            min-height: 20px;
        }

        .status.error {
            color: #dc3545;
        }

        .status.success {
            color: #28a745;
        }

        /* Table Styling */
        .table-wrapper {
            overflow-x: auto;
            max-height: 500px;
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            min-width: 600px; /* Ensure a minimum width for large tables */
        }

        th, td {
            border: 1px solid #eee;
            padding: 12px 15px;
            text-align: left;
            white-space: nowrap; /* Prevent cell content from wrapping */
        }

        thead th {
            background-color: #f1f1f1;
            color: #333;
            font-weight: bold;
            position: sticky; /* Sticky header for scrolling */
            top: 0;
            z-index: 10;
        }

        tbody tr:nth-child(even) {
            background-color: #f8f8f8;
        }

        tbody tr:hover {
            background-color: #f0f0f0;
        }
        
        /* Link specific styling */
        td a {
            color: #007bff; /* Standard link color */
            text-decoration: none;
            font-weight: 500;
        }

        td a:hover {
            text-decoration: underline;
            color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="card">
            <h1>CSV Viewer</h1>
            <p class="subtitle">
                Upload a <code>.csv</code> file to preview it as a table.
                Nothing is uploaded to a server ‚Äì everything happens in your browser.
            </p>

            <div class="controls">
                <label class="file-label">
                    <span class="icon">üìÅ</span>
                    <span>Select CSV</span>
                    <input type="file" id="csvInput" class="file-input" accept=".csv" />
                </label>

                <button id="downloadJsonBtn" class="btn" disabled>
                    <span>‚¨á</span> Download JSON
                </button>

                <span id="fileName" class="file-name"></span>

                <span class="tag">Client-side only</span>
            </div>

            <div id="status" class="status"></div>

            <div id="tableContainer" class="table-wrapper" style="display: none;"></div>
        </div>
    </div>

    <script>
        const input = document.getElementById("csvInput");
        const container = document.getElementById("tableContainer");
        const statusEl = document.getElementById("status");
        const fileNameEl = document.getElementById("fileName");
        const downloadJsonBtn = document.getElementById("downloadJsonBtn");

        let parsedData = []; // will hold array-of-arrays

        input.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (!file.name.toLowerCase().endsWith(".csv")) {
                showStatus("Please upload a .csv file", "error");
                input.value = "";
                container.style.display = "none";
                fileNameEl.textContent = "";
                downloadJsonBtn.disabled = true;
                parsedData = [];
                return;
            }

            fileNameEl.textContent = file.name;
            showStatus("Reading file‚Ä¶", "normal");

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const text = event.target.result;
                    parsedData = parseCSV(text);
                    if (!parsedData.length) {
                        showStatus("CSV appears to be empty.", "error");
                        container.style.display = "none";
                        downloadJsonBtn.disabled = true;
                        return;
                    }
                    renderTable(parsedData);
                    container.style.display = "block";
                    downloadJsonBtn.disabled = false;
                    // Subtract 1 for the header row
                    showStatus("Loaded " + (parsedData.length - 1) + " rows.", "success");
                } catch (err) {
                    console.error(err);
                    showStatus("Error parsing CSV.", "error");
                }
            };
            reader.onerror = () => {
                showStatus("Could not read file.", "error");
            };
            reader.readAsText(file);
        });

        // Basic CSV parser that handles quoted fields
        function parseCSV(text) {
            const rows = [];
            let currentRow = [];
            let currentValue = "";
            let insideQuotes = false;

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];

                if (char === '"' && !insideQuotes) {
                    insideQuotes = true;
                } else if (char === '"' && insideQuotes) {
                    if (nextChar === '"') {
                        currentValue += '"';
                        i++;
                    } else {
                        insideQuotes = false;
                    }
                } else if (char === "," && !insideQuotes) {
                    currentRow.push(currentValue.trim());
                    currentValue = "";
                } else if ((char === "\n" || char === "\r") && !insideQuotes) {
                    if (currentValue !== "" || currentRow.length > 0) {
                        currentRow.push(currentValue.trim());
                        rows.push(currentRow);
                        currentRow = [];
                        currentValue = "";
                    }
                    if (char === "\r" && nextChar === "\n") {
                        i++;
                    }
                } else {
                    currentValue += char;
                }
            }

            if (currentValue !== "" || currentRow.length > 0) {
                currentRow.push(currentValue.trim());
                rows.push(currentRow);
            }

            // Filter out truly empty lines
            return rows.filter(
                (row) => row.length && row.some((cell) => cell.trim() !== "")
            );
        }

        // Function to check if a string is a simple URL
        function isURL(str) {
            if (!str || str.length < 5) return false;
            // Enhanced regex to check for common URL patterns (starting with http://, https://, or common domain formats)
            const urlPattern = new RegExp(
                '^(https?:\\/\\/)?' + // protocol (optional)
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)*[a-z]{2,})' + // domain name
                '(\\:\\d+)?' + // port (optional)
                '(\\/[-a-z\\d%_.~+]*)*' + // path (optional)
                '(\\?[;&a-z\\d%_.~+=-]*)?' + // query string (optional)
                '(\\#[-a-z\\d_]*)?$', // fragment locator (optional)
                'i' // case-insensitive
            );
            return !!urlPattern.test(str.trim());
        }

        // Function to render the table with clickable links
        function renderTable(rows) {
            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");

            // Create Header Row
            const headerRow = document.createElement("tr");
            rows[0].forEach((col, idx) => {
                const th = document.createElement("th");
                th.textContent = col || "Column " + (idx + 1);
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            // Create Data Rows (starting from index 1)
            for (let i = 1; i < rows.length; i++) {
                const tr = document.createElement("tr");
                rows[i].forEach((cell) => {
                    const td = document.createElement("td");
                    
                    if (isURL(cell)) {
                        const a = document.createElement("a");
                        let href = cell.trim();
                        
                        // Prepend 'http://' if protocol is missing
                        if (!href.match(/^(http|https):\/\//i)) {
                            href = 'http://' + href;
                        }
                        
                        a.href = href;
                        a.textContent = cell;
                        a.target = "_blank"; // Open link in a new tab
                        td.appendChild(a);
                    } else {
                        td.textContent = cell;
                    }
                    
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            }

            table.appendChild(thead);
            table.appendChild(tbody);

            container.innerHTML = "";
            container.appendChild(table);
        }

        function showStatus(msg, type) {
            statusEl.textContent = msg || "";
            statusEl.classList.remove("error", "success");
            if (type === "error") statusEl.classList.add("error");
            if (type === "success") statusEl.classList.add("success");
        }

        downloadJsonBtn.addEventListener("click", () => {
            if (!parsedData.length) return;
            const [header, ...body] = parsedData;
            const jsonArray = body.map((row) => {
                const obj = {};
                header.forEach((h, idx) => {
                    // Use clean header or fallback
                    const key = h.trim().replace(/\s+/g, '_') || "col_" + (idx + 1);
                    obj[key] = row[idx] ?? "";
                });
                return obj;
            });

            const blob = new Blob([JSON.stringify(jsonArray, null, 2)], {
                type: "application/json",
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "data.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>

<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CSV Table Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      padding: 16px;
    }
    .app {
      width: 100%;
      max-width: 1100px;
    }
    .card {
      background: #020617;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 18px 18px 22px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
    }
    h1 {
      margin: 0 0 4px;
      font-size: 1.4rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #f9fafb;
    }
    .subtitle {
      margin: 0 0 16px;
      font-size: 0.85rem;
      color: #9ca3af;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }
    .file-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 11px;
      border-radius: 999px;
      background: #0f172a;
      border: 1px solid #4b5563;
      font-size: 0.83rem;
      cursor: pointer;
      transition: border 0.18s ease, background 0.18s ease, transform 0.1s ease;
    }
    .file-label:hover {
      background: #111827;
      border-color: #e5e7eb;
      transform: translateY(-1px);
    }
    .file-label span.icon {
      font-size: 1rem;
    }
    .file-input {
      display: none;
    }
    .file-name {
      font-size: 0.78rem;
      color: #9ca3af;
      max-width: 240px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .btn {
      padding: 7px 11px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.78rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.18s ease, border 0.18s ease, transform 0.1s ease;
    }
    .btn:hover {
      background: #0b1120;
      border-color: #e5e7eb;
      transform: translateY(-1px);
    }
    .btn:disabled {
      opacity: 0.4;
      cursor: default;
      transform: none;
    }
    .tag {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #d1d5db;
      background: rgba(15, 23, 42, 0.7);
    }
    .status {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-top: 6px;
      min-height: 16px;
    }
    .status.error {
      color: #fda4af;
    }
    .status.success {
      color: #4ade80;
    }
    .table-wrapper {
      margin-top: 16px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #020617;
      max-height: 70vh;
      overflow: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.8rem;
      min-width: 500px;
    }
    thead {
      position: sticky;
      top: 0;
      z-index: 1;
      background: radial-gradient(circle at top, #1f2937, #020617);
    }
    th, td {
      padding: 7px 9px;
      border-bottom: 1px solid #111827;
    }
    th {
      text-align: left;
      font-weight: 600;
      color: #e5e7eb;
      white-space: nowrap;
    }
    tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.7);
    }
    tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.4);
    }
    tbody tr:hover {
      background: #1f2937;
    }
    td {
      color: #d1d5db;
    }
    @media (max-width: 640px) {
      .card {
        padding: 14px 12px 18px;
      }
      h1 {
        font-size: 1.1rem;
      }
      .subtitle {
        font-size: 0.78rem;
      }
      table {
        min-width: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>CSV Viewer</h1>
      <p class="subtitle">
        Upload a <code>.csv</code> file to preview it as a table.  
        Nothing is uploaded to a server ‚Äì everything happens in your browser.
      </p>

      <div class="controls">
        <label class="file-label">
          <span class="icon">üìÅ</span>
          <span>Select CSV</span>
          <input type="file" id="csvInput" class="file-input" accept=".csv" />
        </label>

        <button id="downloadJsonBtn" class="btn" disabled>
          <span>‚¨á</span> Download JSON
        </button>

        <span id="fileName" class="file-name"></span>

        <span class="tag">Client-side only</span>
      </div>

      <div id="status" class="status"></div>

      <div id="tableContainer" class="table-wrapper" style="display: none;"></div>
    </div>
  </div>

  <script>
    const input = document.getElementById("csvInput");
    const container = document.getElementById("tableContainer");
    const statusEl = document.getElementById("status");
    const fileNameEl = document.getElementById("fileName");
    const downloadJsonBtn = document.getElementById("downloadJsonBtn");

    let parsedData = []; // will hold array-of-arrays

    input.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.name.toLowerCase().endsWith(".csv")) {
        showStatus("Please upload a .csv file", "error");
        input.value = "";
        container.style.display = "none";
        fileNameEl.textContent = "";
        downloadJsonBtn.disabled = true;
        parsedData = [];
        return;
      }

      fileNameEl.textContent = file.name;
      showStatus("Reading file‚Ä¶", "normal");

      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const text = event.target.result;
          parsedData = parseCSV(text);
          if (!parsedData.length) {
            showStatus("CSV appears to be empty.", "error");
            container.style.display = "none";
            downloadJsonBtn.disabled = true;
            return;
          }
          renderTable(parsedData);
          container.style.display = "block";
          downloadJsonBtn.disabled = false;
          showStatus("Loaded " + (parsedData.length - 1) + " rows.", "success");
        } catch (err) {
          console.error(err);
          showStatus("Error parsing CSV.", "error");
        }
      };
      reader.onerror = () => {
        showStatus("Could not read file.", "error");
      };
      reader.readAsText(file);
    });

    // basic CSV parser that handles quoted fields
    function parseCSV(text) {
      const rows = [];
      let currentRow = [];
      let currentValue = "";
      let insideQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const nextChar = text[i + 1];

        if (char === '"' && !insideQuotes) {
          insideQuotes = true;
        } else if (char === '"' && insideQuotes) {
          if (nextChar === '"') {
            currentValue += '"';
            i++;
          } else {
            insideQuotes = false;
          }
        } else if (char === "," && !insideQuotes) {
          currentRow.push(currentValue);
          currentValue = "";
        } else if ((char === "\n" || char === "\r") && !insideQuotes) {
          if (currentValue !== "" || currentRow.length > 0) {
            currentRow.push(currentValue);
            rows.push(currentRow);
            currentRow = [];
            currentValue = "";
          }
          if (char === "\r" && nextChar === "\n") {
            i++;
          }
        } else {
          currentValue += char;
        }
      }

      if (currentValue !== "" || currentRow.length > 0) {
        currentRow.push(currentValue);
        rows.push(currentRow);
      }

      return rows.filter(
        (row) => row.length && row.some((cell) => cell.trim() !== "")
      );
    }

    function renderTable(rows) {
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const tbody = document.createElement("tbody");

      const headerRow = document.createElement("tr");
      rows[0].forEach((col, idx) => {
        const th = document.createElement("th");
        th.textContent = col || "Column " + (idx + 1);
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      for (let i = 1; i < rows.length; i++) {
        const tr = document.createElement("tr");
        rows[i].forEach((cell) => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      }

      table.appendChild(thead);
      table.appendChild(tbody);

      container.innerHTML = "";
      container.appendChild(table);
    }

    function showStatus(msg, type) {
      statusEl.textContent = msg || "";
      statusEl.classList.remove("error", "success");
      if (type === "error") statusEl.classList.add("error");
      if (type === "success") statusEl.classList.add("success");
    }

    downloadJsonBtn.addEventListener("click", () => {
      if (!parsedData.length) return;
      const [header, ...body] = parsedData;
      const jsonArray = body.map((row) => {
        const obj = {};
        header.forEach((h, idx) => {
          const key = h || "col_" + (idx + 1);
          obj[key] = row[idx] ?? "";
        });
        return obj;
      });

      const blob = new Blob([JSON.stringify(jsonArray, null, 2)], {
        type: "application/json",
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "data.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html> -->
